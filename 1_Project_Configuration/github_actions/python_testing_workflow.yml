# ==============================================================================
# FILE: 1_Project_Configuration/github_actions/python_testing_workflow.yml
# PURPOSE: This GitHub Actions workflow automates the testing process for the
#          Decyphr library. It runs on every push and pull request.
# ==============================================================================

# Name of the workflow as it will appear in the "Actions" tab of your GitHub repository.
name: Decyphr CI - Python Package Testing

# --- Triggers ---
# Specifies when this workflow should run.
on:
  push:
    branches: [ "main" ] # Runs when you push to the main branch
  pull_request:
    branches: [ "main" ] # Runs when a pull request is made to the main branch

# --- Jobs ---
# A workflow run is made up of one or more jobs that can run sequentially or in parallel.
jobs:
  # The "build" job is our main testing job.
  build:

    # The type of runner that the job will run on. We'll test on the latest Ubuntu.
    runs-on: ubuntu-latest
    
    # A strategy for running the job with different versions of Python.
    # This ensures your library is compatible across multiple Python versions.
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.9", "3.10", "3.11"]

    # Steps represent a sequence of tasks that will be executed as part of the job.
    steps:
    # --- Step 1: Check out the repository ---
    # This action checks-out your repository under $GITHUB_WORKSPACE, so your job can access it.
    - uses: actions/checkout@v3

    # --- Step 2: Set up Python ---
    # This action sets up a Python environment for use in actions.
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    # --- Step 3: Install Dependencies ---
    # This step installs all necessary libraries, including your project itself.
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install flake8 pytest
        # Install your package with all optional dependencies for full testing coverage
        pip install -e ".[all]"
        # Download the required SpaCy model for the text analysis plugin
        python -m spacy download en_core_web_sm

    # --- Step 4: Lint with flake8 ---
    # This step checks your code for style issues and basic errors.
    - name: Lint with flake8
      run: |
        # stop the build if there are Python syntax errors or undefined names
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

    # --- Step 5: Run Tests with pytest ---
    # This step runs your test suite located in the `4_Testing/` directory.
    - name: Test with pytest
      run: |
        pytest 4_Testing/